<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Connection Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-family: monospace;
        }
        .success { background: rgba(34, 197, 94, 0.2); border-left: 4px solid #22c55e; }
        .error { background: rgba(239, 68, 68, 0.2); border-left: 4px solid #ef4444; }
        .info { background: rgba(59, 130, 246, 0.2); border-left: 4px solid #3b82f6; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #2563eb; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Supabase Connection Test</h1>
        <p>Test your Supabase configuration before deployment</p>
        
        <button onclick="testConnection()">Test Connection</button>
        <button onclick="testSchema()">Test Schema</button>
        <button onclick="insertTestGame()">Insert Test Game</button>
        <button onclick="fetchGames()">Fetch Games</button>
        
        <div id="results"></div>
    </div>

    <script type="module">
        // Inline Supabase configuration for testing
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js';
        
        const supabaseUrl = 'https://ynxrocumivaenpoyxskf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlueHJvY3VtaXZhZW5wb3l4c2tmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0MDM3ODQsImV4cCI6MjA3Njk3OTc4NH0.kK8yinWZyfmhsY5P7hyh3UKl1WKUAo6IW4bvS-4hO4o';
        
        const supabase = createClient(supabaseUrl, supabaseKey);
        
        window.supabase = supabase; // Make it globally available
        
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        window.testConnection = async function() {
            addResult('üîÑ Testing Supabase connection...', 'info');
            try {
                const { data, error } = await supabase.from('games').select('count').limit(1);
                if (error) throw error;
                addResult('‚úÖ Supabase connection successful!', 'success');
            } catch (error) {
                addResult(`‚ùå Connection failed: ${error.message}`, 'error');
            }
        };
        
        window.testSchema = async function() {
            addResult('üîÑ Testing database schema...', 'info');
            try {
                // Test if the simplified games table exists and has the right structure
                const { data: games, error: gamesError } = await supabase.from('games').select('*').limit(1);
                if (gamesError) throw new Error(`Games table: ${gamesError.message}`);
                
                addResult('‚úÖ Simplified database schema is working perfectly!', 'success');
                addResult('&nbsp;&nbsp;‚Ä¢ Games table: ‚úÖ Accessible', 'info');
                addResult('&nbsp;&nbsp;‚Ä¢ No complex tables needed - simplified design working!', 'info');
            } catch (error) {
                addResult(`‚ùå Schema test failed: ${error.message}`, 'error');
            }
        };
        
        window.insertTestGame = async function() {
            addResult('üîÑ Inserting test game...', 'info');
            try {
                const testGame = {
                    title: 'Test Game ' + Date.now(),
                    author: 'Novellium Test',
                    description: 'A test game created by the connection tester',
                    game_id: 'test-game-' + Date.now(),
                    config: { 
                        title: 'Test Game',
                        author: 'Novellium Test',
                        initialEvent: 'start'
                    },
                    characters: { 
                        "hero": { 
                            name: "Hero", 
                            color: "#ffd700" 
                        } 
                    },
                    events: { 
                        "start": { 
                            type: "dialogue", 
                            character: "hero",
                            text: "Welcome to the test!",
                            next: "end"
                        },
                        "end": {
                            type: "narration",
                            text: "Test complete!"
                        }
                    },
                    is_public: true
                };
                
                const { data, error } = await supabase
                    .from('games')
                    .insert([testGame])
                    .select()
                    .single();
                
                if (error) throw error;
                addResult(`‚úÖ Test game inserted successfully! ID: ${data.id}`, 'success');
            } catch (error) {
                addResult(`‚ùå Failed to insert test game: ${error.message}`, 'error');
            }
        };
        
        window.fetchGames = async function() {
            addResult('üîÑ Fetching games from database...', 'info');
            try {
                const { data, error } = await supabase
                    .from('games')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(5);
                
                if (error) throw error;
                
                if (data.length === 0) {
                    addResult('üìù No games found in database', 'info');
                } else {
                    addResult(`‚úÖ Found ${data.length} games:`, 'success');
                    data.forEach(game => {
                        addResult(`&nbsp;&nbsp;‚Ä¢ ${game.title} by ${game.author} (${game.created_at})`, 'info');
                    });
                }
            } catch (error) {
                addResult(`‚ùå Failed to fetch games: ${error.message}`, 'error');
            }
        };
        
        // Auto-test connection on load
        addResult('üéÆ Novellium Supabase Test Suite Ready', 'info');
        addResult('Click the buttons above to test your Supabase integration', 'info');
    </script>
</body>
</html>